## 2024.6.17

### Preprocessing.py

在今天上传的这些文件中，是仍然很不成熟的一个模型，尽管想过一些改进，但奈何时间不充裕，没有办法理想地提升效果。

在 Preprocessing.py 这个程序文件中，里面包含了序列分解和分量重构的预处理方法。

运行此文件时，只需要输入初始的数据集路径即可，程序会首先进行经验模态分解（EMD），将初始信号分解成多个固有模态函数和一个残差序列，但残差序列往往非常小，因此在后面的分析中不讨论。经验模态分解部分会导出 经验模态分解结果.xlsx 和 经验模态分解可视化.png。 

接着，会用 auto_arima 这个函数去用 ARIMA 拟合平滑后的初始信号和固有模态函数，由于 ARIMA 是线性模型，ARIMA 拟合序列可以被视为线性，因此，每个子序列的距离可以衡量其非线性程度。若距离大于等于初始信号的拟合序列则视为非线性、反之则视为线性。导出的 IMF拟合数据.xlsx 是每个固有模态函数的拟合结果。判别后会导出 线性子序列.xlsx 和 非线性子序列.xlsx 这两个文件。关于 ARIMA 拟合的参数和距离有打印出来但没保存，有需要直接复制。

最后，对每个非线性子序列进行奇异谱分析，这个地方有两个需要调整的参数**windowLen**和**threshold_index**，**windowLen**是窗口长度，一般可以设置成周期，**threshold_index**是选取前多少个奇异值，**这个地方的调整我还没有想到应该如何去自动设置，只能通过可视化去微调**，一般来说像仓库里面的可视化那样就差不多（哈哈好抽象）。然后导出 线性分量.xlsx 和 非线性分量.xlsx 这两个文件。

### ComponentPredict.py

在这个程序文件中，首先会绘制初始信号与线性非线性分量的可视化，并导出文件 数据预处理可视化.png 。

接着是线性分量的预测，依旧使用 auto_arima 这个函数，会打印摘要，但没有设置保存。

在非线性分量预测部分，会先指定自变量 X ，如果没有多变量，就只有时间和因变量，那么 X 就直接设置 X = data[['Year', 'Month', 'Day']]。

然后是基于TPE过程的贝叶斯优化进行超参数寻优，最佳超参数组合会导出为 非线性分量预测超参数组合.xlsx ，最终这个程序文件会导出 线性分量预测结果.xlsx 和 非线性分量预测结果.xlsx 。线性分量和非线性分量的和就是最终的预测值。

### 不成熟之处

1. threshold_index没有一个自动的选择功能，而且最终分量重构的结果受SSA分解影响很大。

2. 最终结果仅仅是线性分量和非线性分量的预测结果相加，目前尝试的后处理和构建滞后变量输入新的模型预测，鲁棒性让人堪忧，还需要时间去改进。
